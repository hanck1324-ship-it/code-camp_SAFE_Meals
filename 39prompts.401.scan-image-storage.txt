ì•„ë˜ì˜ ì¡°ê±´ì„ ëª¨ë‘ ì ìš©í•˜ì—¬, ì•„ë˜ì˜ ìš”êµ¬ì‚¬í•­ì„ ëª¨ë‘ êµ¬í˜„í•  ê²ƒ.
êµ¬í˜„ ê²°ê³¼ë¥¼ ì²´í¬ë¦¬ìŠ¤íŠ¸ë¡œ ë°˜í™˜í•  ê²ƒ.

==============================================

ì¡°ê±´-ì»¤ì„œë£°) ì•„ë˜ì˜ ì»¤ì„œë£°ì„ ì ìš©í•˜ì—¬ ì‘ì—…í•˜ê³ , ì´ ì‘ì—…ì´ ëë‚˜ë©´ í•´ë‹¹ rules ì ìš© ê²°ê³¼ë¥¼ ì²´í¬ë¦¬ìŠ¤íŠ¸ë¡œ ë°˜í™˜í•  ê²ƒ.
            - @01-common.mdc
            - @04-func.mdc

==============================================

ì¡°ê±´-íŒŒì¼ê²½ë¡œ) ìˆ˜ì •ë  API ë¼ìš°íŠ¸ íŒŒì¼ê²½ë¡œ: apps/web/src/app/api/scan/analyze/route.ts
ì¡°ê±´-íŒŒì¼ê²½ë¡œ) ìƒì„±ë  ìœ í‹¸ë¦¬í‹° íŒŒì¼ê²½ë¡œ: apps/web/src/utils/scan-image-storage.ts
ì¡°ê±´-íŒŒì¼ê²½ë¡œ) ìƒì„±ë  íƒ€ì… íŒŒì¼ê²½ë¡œ: apps/web/src/types/scan-storage.types.ts (ê¸°ì¡´ scan-history.types.tsì— ì¶”ê°€í•´ë„ ë¨)
ì¡°ê±´-íŒŒì¼ê²½ë¡œ) ìˆ˜ì •ë  Repository íŒŒì¼ê²½ë¡œ: apps/web/src/utils/scan-history-repository.ts
ì¡°ê±´-íŒŒì¼ê²½ë¡œ) ì°¸ê³  ìŠ¤í‚¤ë§ˆ ë¬¸ì„œ: /code-camp_SAFE_Meals/docs/schema.md

==============================================

í•µì‹¬ìš”êµ¬ì‚¬í•­) ë©”ë‰´ ìŠ¤ìº” ì‹œ ì´¬ì˜/ì—…ë¡œë“œí•œ ì´ë¯¸ì§€ë¥¼ Supabase Storageì— ì €ì¥í•˜ê³ , í•´ë‹¹ URLì„ scan_history.image_urlì— ê¸°ë¡í•˜ëŠ” ê¸°ëŠ¥ì„ êµ¬í˜„í•  ê²ƒ.

1) ëª©í‘œ
    - ìŠ¤ìº”ëœ ë©”ë‰´ ì´ë¯¸ì§€ë¥¼ ì˜êµ¬ì ìœ¼ë¡œ ì €ì¥í•˜ì—¬ ì‚¬ìš©ìê°€ ë‚˜ì¤‘ì— í™•ì¸ ê°€ëŠ¥
    - ëŒ€ì‹œë³´ë“œì˜ "ìµœê·¼ ìŠ¤ìº” ì´ë ¥" ì¸ë„¤ì¼ê³¼ ì—°ë™
    - RLS(Row Level Security) ì •ì±…ì„ ì¤€ìˆ˜í•˜ì—¬ ì‚¬ìš©ìë³„ ì´ë¯¸ì§€ ê²©ë¦¬
    - ì´ë¯¸ì§€ ìš©ëŸ‰ ìµœì í™” (ë¦¬ì‚¬ì´ì§•/ì••ì¶•)

2) Supabase Storage ë²„í‚· ì„¤ì •
    2-1) ë§ˆì´ê·¸ë ˆì´ì…˜ íŒŒì¼ ìƒì„± ìœ„ì¹˜
        - ê²½ë¡œ: apps/web/supabase/migrations/YYYYMMDD_create_scan_images_bucket.sql
        - ë˜ëŠ” Supabase Dashboard > SQL Editorì—ì„œ ì§ì ‘ ì‹¤í–‰

    2-2) ë²„í‚· ìƒì„± SQL (Supabase Dashboard ë˜ëŠ” Migrationì—ì„œ ì‹¤í–‰)
        ```sql
        -- ìŠ¤ìº” ì´ë¯¸ì§€ ì €ì¥ìš© ë²„í‚· ìƒì„±
        INSERT INTO storage.buckets (id, name, public, file_size_limit, allowed_mime_types)
        VALUES (
            'scan-images',
            'scan-images',
            true,  -- ê³µê°œ ë²„í‚· (URLë¡œ ì§ì ‘ ì ‘ê·¼ ê°€ëŠ¥)
            5242880,  -- 5MB ì œí•œ
            ARRAY['image/jpeg', 'image/png', 'image/webp']
        );
        ```

    2-2) Storage RLS ì •ì±… ì„¤ì •
        ```sql
        -- ì¸ì¦ëœ ì‚¬ìš©ìë§Œ ìì‹ ì˜ í´ë”ì— ì—…ë¡œë“œ ê°€ëŠ¥
        CREATE POLICY "Users can upload scan images to own folder"
        ON storage.objects FOR INSERT
        WITH CHECK (
            bucket_id = 'scan-images' AND
            auth.uid() IS NOT NULL AND
            (storage.foldername(name))[1] = auth.uid()::text
        );

        -- ê³µê°œ ë²„í‚·ì´ë¯€ë¡œ ëª¨ë“  ì‚¬ìš©ì ì½ê¸° ê°€ëŠ¥
        CREATE POLICY "Anyone can view scan images"
        ON storage.objects FOR SELECT
        USING (bucket_id = 'scan-images');

        -- ë³¸ì¸ ì´ë¯¸ì§€ë§Œ ì‚­ì œ ê°€ëŠ¥
        CREATE POLICY "Users can delete own scan images"
        ON storage.objects FOR DELETE
        USING (
            bucket_id = 'scan-images' AND
            auth.uid() IS NOT NULL AND
            (storage.foldername(name))[1] = auth.uid()::text
        );
        ```

    2-3) ë²„í‚· ì¡´ì¬ ì—¬ë¶€ í™•ì¸ í›„ ìƒì„± (idempotent)
        ```sql
        -- ë²„í‚·ì´ ì—†ì„ ë•Œë§Œ ìƒì„± (ì¤‘ë³µ ì‹¤í–‰ ì•ˆì „)
        DO $$
        BEGIN
          IF NOT EXISTS (SELECT 1 FROM storage.buckets WHERE id = 'scan-images') THEN
            INSERT INTO storage.buckets (id, name, public, file_size_limit, allowed_mime_types)
            VALUES (
                'scan-images',
                'scan-images',
                true,
                5242880,
                ARRAY['image/jpeg', 'image/png', 'image/webp']
            );
          END IF;
        END $$;
        ```

3) íŒŒì¼ ì €ì¥ ê²½ë¡œ ê·œì¹™
    3-1) ê²½ë¡œ í¬ë§·
        {user_id}/{year}/{month}/{scan_id}_{timestamp}.{extension}
        
        ì˜ˆì‹œ: 550e8400-e29b-41d4-a716-446655440000/2026/01/abc123_1704672000000.webp

    3-2) íŒŒì¼ëª… ìƒì„± í•¨ìˆ˜
        ```typescript
        function generateImagePath(userId: string, scanId: string): string {
          const now = new Date();
          const year = now.getFullYear();
          const month = String(now.getMonth() + 1).padStart(2, '0');
          const timestamp = now.getTime();
          
          return `${userId}/${year}/${month}/${scanId}_${timestamp}.webp`;
        }
        ```

4) TypeScript íƒ€ì… ì •ì˜ (scan-storage.types.ts)
    4-1) ImageUploadParams íƒ€ì…
        ```typescript
        interface ImageUploadParams {
          userId: string;
          scanId: string;
          imageData: string;  // Base64 ë˜ëŠ” Data URL
          contentType?: 'image/jpeg' | 'image/png' | 'image/webp';
        }
        ```

    4-2) ImageUploadResult íƒ€ì…
        ```typescript
        interface ImageUploadResult {
          success: boolean;
          publicUrl?: string;
          storagePath?: string;
          error?: string;
        }
        ```

    4-3) ImageProcessOptions íƒ€ì…
        ```typescript
        interface ImageProcessOptions {
          maxWidth?: number;      // ê¸°ë³¸ê°’: 1200
          maxHeight?: number;     // ê¸°ë³¸ê°’: 1200
          quality?: number;       // 0-100, ê¸°ë³¸ê°’: 80
          format?: 'webp' | 'jpeg';  // ê¸°ë³¸ê°’: 'webp'
        }
        ```

5) ì´ë¯¸ì§€ ì²˜ë¦¬ ìœ í‹¸ë¦¬í‹° (scan-image-storage.ts)
    5-1) í´ë˜ìŠ¤ ì„¤ê³„
        ```typescript
        class ScanImageStorage {
          constructor(private supabase: SupabaseClient) {}
          
          // ì´ë¯¸ì§€ ì—…ë¡œë“œ (Base64 â†’ Storage)
          async uploadScanImage(params: ImageUploadParams): Promise<ImageUploadResult>;
          
          // ì´ë¯¸ì§€ ì‚­ì œ
          async deleteScanImage(storagePath: string): Promise<boolean>;
          
          // Public URL ìƒì„±
          getPublicUrl(storagePath: string): string;
        }
        ```

    5-2) Base64 â†’ Blob ë³€í™˜ (ì„œë²„ ì‚¬ì´ë“œ)
        ```typescript
        function base64ToBlob(base64: string, contentType: string): Blob {
          // Data URLì—ì„œ ìˆœìˆ˜ Base64 ì¶”ì¶œ
          const base64Data = base64.includes(',') 
            ? base64.split(',')[1] 
            : base64;
          
          // Node.js Buffer ì‚¬ìš© (Edge Runtime í˜¸í™˜)
          const buffer = Buffer.from(base64Data, 'base64');
          return new Blob([buffer], { type: contentType });
        }
        ```

    5-3) ì´ë¯¸ì§€ ë¦¬ì‚¬ì´ì§•/ì••ì¶• ì „ëµ
        **ì„œë²„ ì‚¬ì´ë“œ ì´ë¯¸ì§€ ì²˜ë¦¬ (ì„ íƒ êµ¬í˜„)**:
        
        [ë°©ë²• 1] sharp ë¼ì´ë¸ŒëŸ¬ë¦¬ ì‚¬ìš© (Node.js ëŸ°íƒ€ì„ í•„ìš”)
        - ì¥ì : ê³ ì„±ëŠ¥, ë‹¤ì–‘í•œ í¬ë§· ì§€ì›
        - ë‹¨ì : Edge Runtime ë¯¸ì§€ì›
        
        [ë°©ë²• 2] í´ë¼ì´ì–¸íŠ¸ì—ì„œ ë¦¬ì‚¬ì´ì§• í›„ ì „ì†¡
        - ì¥ì : ì„œë²„ ë¶€í•˜ ê°ì†Œ, Edge Runtime í˜¸í™˜
        - ë‹¨ì : í´ë¼ì´ì–¸íŠ¸ ì²˜ë¦¬ ì‹œê°„ ì¦ê°€
        
        [ê¶Œì¥] í˜„ì¬ ìŠ¤ì½”í”„ì—ì„œëŠ” ë°©ë²• 2 ì±„íƒ:
        - í´ë¼ì´ì–¸íŠ¸(ëª¨ë°”ì¼ ì•±)ì—ì„œ 1200x1200 ì´í•˜ë¡œ ë¦¬ì‚¬ì´ì§•
        - WebP í¬ë§·ìœ¼ë¡œ ë³€í™˜ í›„ ì „ì†¡
        - ì„œë²„ëŠ” ë°›ì€ ì´ë¯¸ì§€ ê·¸ëŒ€ë¡œ ì €ì¥

    5-4) uploadScanImage êµ¬í˜„
        ```typescript
        async uploadScanImage(params: ImageUploadParams): Promise<ImageUploadResult> {
          try {
            const { userId, scanId, imageData, contentType = 'image/webp' } = params;
            
            // íŒŒì¼ ê²½ë¡œ ìƒì„±
            const storagePath = generateImagePath(userId, scanId);
            
            // Base64 â†’ Blob ë³€í™˜
            const blob = base64ToBlob(imageData, contentType);
            
            // Supabase Storage ì—…ë¡œë“œ
            const { data, error } = await this.supabase.storage
              .from('scan-images')
              .upload(storagePath, blob, {
                contentType,
                upsert: false,  // ì¤‘ë³µ ë°©ì§€
                cacheControl: '31536000',  // 1ë…„ ìºì‹œ
              });
            
            if (error) {
              throw new Error(error.message);
            }
            
            // Public URL ìƒì„±
            const publicUrl = this.getPublicUrl(storagePath);
            
            return {
              success: true,
              publicUrl,
              storagePath,
            };
          } catch (error) {
            console.error('âŒ [ScanImageStorage] ì—…ë¡œë“œ ì‹¤íŒ¨:', error);
            return {
              success: false,
              error: error instanceof Error ? error.message : 'ì´ë¯¸ì§€ ì—…ë¡œë“œ ì‹¤íŒ¨',
            };
          }
        }
        ```

    5-5) Public URL ìƒì„±
        ```typescript
        getPublicUrl(storagePath: string): string {
          const { data } = this.supabase.storage
            .from('scan-images')
            .getPublicUrl(storagePath);
          
          return data.publicUrl;
        }
        ```

6) Repository ìˆ˜ì • (scan-history-repository.ts)
    6-1) SaveScanParams íƒ€ì… í™•ì¥
        ```typescript
        interface SaveScanParams {
          // ... ê¸°ì¡´ í•„ë“œ ìœ ì§€
          imageData?: string | null;  // Base64 ì´ë¯¸ì§€ ë°ì´í„° (ì‹ ê·œ)
        }
        ```

    6-2) saveScan ë©”ì„œë“œ ìˆ˜ì •
        - ì´ë¯¸ì§€ ë°ì´í„°ê°€ ìˆìœ¼ë©´ ë¨¼ì € Storageì— ì—…ë¡œë“œ
        - ì—…ë¡œë“œ ì„±ê³µ ì‹œ ë°˜í™˜ëœ publicUrlì„ image_urlì— ì €ì¥
        - ì—…ë¡œë“œ ì‹¤íŒ¨í•´ë„ ìŠ¤ìº” ì €ì¥ì€ ì§„í–‰ (image_url = null)
        
        ```typescript
        async saveScan(params: SaveScanParams): Promise<SaveScanResult> {
          let imageUrl: string | null = null;
          
          // ì´ë¯¸ì§€ ì—…ë¡œë“œ (ì„ íƒì )
          if (params.imageData) {
            const uploadResult = await this.imageStorage.uploadScanImage({
              userId: params.userId,
              scanId: params.jobId || crypto.randomUUID(),
              imageData: params.imageData,
            });
            
            if (uploadResult.success) {
              imageUrl = uploadResult.publicUrl;
            } else {
              console.warn('âš ï¸ [ScanHistory] ì´ë¯¸ì§€ ì—…ë¡œë“œ ì‹¤íŒ¨, ìŠ¤ìº” ì €ì¥ ê³„ì† ì§„í–‰');
            }
          }
          
          // scan_history ì €ì¥ (image_url í¬í•¨)
          const { data: scanData, error: scanError } = await this.supabase
            .from('scan_history')
            .insert({
              user_id: params.userId,
              scan_type: params.scanType,
              image_url: imageUrl,  // Storage URL ì €ì¥
              restaurant_name: params.restaurantName,
              location: params.location,
              job_id: params.jobId,
            })
            .select('id')
            .single();
          
          // ... ë‚˜ë¨¸ì§€ êµ¬í˜„
        }
        ```

7) API ìˆ˜ì • (route.ts)
    7-1) ìš”ì²­ì—ì„œ ì´ë¯¸ì§€ ë°ì´í„° ì¶”ì¶œ
        - ê¸°ì¡´ API ìš”ì²­ì— imageData í•„ë“œê°€ ìˆìœ¼ë©´ ì „ë‹¬
        
        ```typescript
        // ê¸°ì¡´ ìš”ì²­ íŒŒë¼ë¯¸í„°ì—ì„œ imageData ì¶”ì¶œ
        const { image, language, restaurantName, ...rest } = await req.json();
        
        // saveScan í˜¸ì¶œ ì‹œ imageData ì „ë‹¬
        await repository.saveScan({
          userId: user.id,
          scanType: 'menu',
          imageData: image,  // Base64 ì´ë¯¸ì§€
          restaurantName,
          // ... ë‚˜ë¨¸ì§€ í•„ë“œ
        });
        ```

    7-2) íƒ€ì´ë° ê³„ì¸¡
        ```typescript
        const imageUploadStart = Date.now();
        // ... ì´ë¯¸ì§€ ì—…ë¡œë“œ
        timings.imageUploadMs = Date.now() - imageUploadStart;
        ```

8) ì—ëŸ¬ ì²˜ë¦¬ ë° í´ë°±
    8-1) ì—…ë¡œë“œ ì‹¤íŒ¨ ì‹œ ì „ëµ
        - ì´ë¯¸ì§€ ì—…ë¡œë“œ ì‹¤íŒ¨í•´ë„ ë¶„ì„ ê²°ê³¼ ì €ì¥ì€ ì§„í–‰
        - image_urlì€ nullë¡œ ì €ì¥
        - ì—ëŸ¬ ë¡œê·¸ë§Œ ê¸°ë¡

    8-2) ìš©ëŸ‰ ì´ˆê³¼ ì²˜ë¦¬
        - 5MB ì´ˆê³¼ ì‹œ ì—ëŸ¬ ë°˜í™˜
        - í´ë¼ì´ì–¸íŠ¸ì— ë¦¬ì‚¬ì´ì§• ìš”ì²­ ë©”ì‹œì§€ í¬í•¨

9) ë¡œê¹… ë° ëª¨ë‹ˆí„°ë§
    9-1) ì„±ê³µ ë¡œê·¸
        console.log(`âœ… [ScanImageStorage] ì—…ë¡œë“œ ì™„ë£Œ - path: ${storagePath}`);

    9-2) ì‹¤íŒ¨ ë¡œê·¸
        console.error(`âŒ [ScanImageStorage] ì—…ë¡œë“œ ì‹¤íŒ¨:`, error);

    9-3) ìš©ëŸ‰ ì •ë³´ ë¡œê·¸
        console.log(`ğŸ“Š [ScanImageStorage] ì´ë¯¸ì§€ í¬ê¸°: ${(blob.size / 1024).toFixed(1)}KB`);

==============================================

í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤) Playwright í…ŒìŠ¤íŠ¸ë¡œ ì´ë¯¸ì§€ ì €ì¥ ê¸°ëŠ¥ ê²€ì¦

1) í…ŒìŠ¤íŠ¸ íŒŒì¼: tests/scan-image-storage.with-scans.spec.ts

2) í…ŒìŠ¤íŠ¸ ì¡°ê±´
   - timeoutì€ ì„¤ì •í•˜ì§€ ì•Šê±°ë‚˜, 500ms ë¯¸ë§Œìœ¼ë¡œ ì„¤ì •í•  ê²ƒ.
   - í˜ì´ì§€ê°€ ì™„ì „íˆ ë¡œë“œëœ í›„ í…ŒìŠ¤íŠ¸í•  ê²ƒ.
       - í˜ì´ì§€ ë¡œë“œ ì‹ë³„ ìš”êµ¬ì‚¬í•­: ê³ ì •ì‹ë³„ì data-testid ëŒ€ê¸° ë°©ë²•
       - **ì¤‘ìš”ê¸ˆì§€ì‚¬í•­** í˜ì´ì§€ ë¡œë“œ ì‹ë³„ ê¸ˆì§€ì‚¬í•­: networkidle ëŒ€ê¸° ë°©ë²•

3) í…ŒìŠ¤íŠ¸ ì¸ì¦ ì „ëµ
   3-1) ì €ì¥ëœ ì¸ì¦ ìƒíƒœ ì‚¬ìš© (Storage State)
        - Playwrightì˜ storageState ê¸°ëŠ¥ì„ í™œìš©í•˜ì—¬ ë¡œê·¸ì¸ ì„¸ì…˜ ì¬ì‚¬ìš©
        - playwright/.auth/with-scans.json (ìŠ¤ìº” ê¸°ë¡ ìˆëŠ” ê³„ì •)

   3-2) Playwright í”„ë¡œì íŠ¸ ì„¤ì •
        - authenticated-with-scans í”„ë¡œì íŠ¸ ì‚¬ìš©
        - *.with-scans.spec.ts íŒŒì¼ëª… íŒ¨í„´

4) í…ŒìŠ¤íŠ¸ ë°ì´í„° ì¡°ê±´ (Fixture ê´€ë¦¬)
   4-1) ë°ì´í„° ì „ëµ
        - ì‹¤ì œ Supabase Storage ì‚¬ìš© (Mock ê¸ˆì§€)
        - Service Role Keyë¡œ í…ŒìŠ¤íŠ¸ í›„ ì´ë¯¸ì§€ í´ë¦°ì—…
        - í…ŒìŠ¤íŠ¸ìš© ì‘ì€ ì´ë¯¸ì§€ ì‚¬ìš© (100x100px Base64)

   4-2) RLS(Row Level Security) ëŒ€ì‘ ì „ëµ
        - Storage ì—…ë¡œë“œ/ì‚­ì œëŠ” ì¸ì¦ëœ ì‚¬ìš©ì ì„¸ì…˜ ì‚¬ìš©
        - í…ŒìŠ¤íŠ¸ í›„ ì •ë¦¬ëŠ” Service Role Key ì‚¬ìš© ê°€ëŠ¥

   4-3) Fixture ê´€ë¦¬ ê·œì¹™
        - í…ŒìŠ¤íŠ¸ ì‹œì‘ ì „: í•„ìš” ì‹œ ì‹œë“œ ì´ë¯¸ì§€ ì—…ë¡œë“œ (beforeAll)
        - í…ŒìŠ¤íŠ¸ ì¢…ë£Œ í›„: í…ŒìŠ¤íŠ¸ ì´ë¯¸ì§€ ì •ë¦¬ (afterAll)
        - **ê³ ìœ  ì‹ë³„ì í¬í•¨** (ë³‘ë ¬ ì‹¤í–‰ ì¶©ëŒ ë°©ì§€)
        ```typescript
        // í…ŒìŠ¤íŠ¸ìš© ì´ë¯¸ì§€ ê²½ë¡œì— testRunId í¬í•¨
        const testImagePath = `${userId}/${testRunId}/test_${Date.now()}.webp`;
        ```

   4-4) Cleanup í•¨ìˆ˜
        ```typescript
        export async function cleanupTestImages(userId: string, testRunId: string) {
          const { data: files } = await serviceClient.storage
            .from('scan-images')
            .list(`${userId}/${testRunId}`);
          
          if (files?.length) {
            const paths = files.map(f => `${userId}/${testRunId}/${f.name}`);
            await serviceClient.storage.from('scan-images').remove(paths);
          }
        }
        ```

5) í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤
    5-1) ì´ë¯¸ì§€ í¬í•¨ ìŠ¤ìº” í›„ Storage ì €ì¥ ê²€ì¦
        - ë©”ë‰´ ì´ë¯¸ì§€ì™€ í•¨ê»˜ ìŠ¤ìº” ì‹¤í–‰
        - ë¶„ì„ ì™„ë£Œ ëŒ€ê¸°
        - scan_history.image_urlì´ ìœ íš¨í•œ Storage URLì¸ì§€ í™•ì¸
        - URL íŒ¨í„´: https://*.supabase.co/storage/v1/object/public/scan-images/*
        - URLë¡œ ì´ë¯¸ì§€ ì ‘ê·¼ ê°€ëŠ¥í•œì§€ í™•ì¸ (HTTP 200)

    5-2) ì´ë¯¸ì§€ ì—†ì´ ìŠ¤ìº” ì‹œ image_url = null ê²€ì¦
        - ì´ë¯¸ì§€ ì—†ì´ í…ìŠ¤íŠ¸ë§Œ ë¶„ì„
        - scan_history.image_urlì´ nullì¸ì§€ í™•ì¸

    5-3) ëŒ€ìš©ëŸ‰ ì´ë¯¸ì§€ ê±°ë¶€ ê²€ì¦ (5MB ì´ˆê³¼)
        - 6MB ì´ë¯¸ì§€ë¡œ ìŠ¤ìº” ì‹œë„
        - ì ì ˆí•œ ì—ëŸ¬ ë©”ì‹œì§€ ë°˜í™˜ í™•ì¸

6) ë³‘ë ¬ ì‹¤í–‰ ì¶©ëŒ ë°©ì§€
    ```typescript
    // scan-image-storage.with-scans.spec.ts
    test.describe.configure({ mode: 'serial' });
    
    test.describe('ìŠ¤ìº” ì´ë¯¸ì§€ Storage ì €ì¥', () => {
      const testRunId = uuidv4();
      
      test.afterAll(async () => {
        await cleanupTestImages(userId, testRunId);
      });
      
      // ... tests
    });
    ```

==============================================

ì²´í¬ë¦¬ìŠ¤íŠ¸ ì˜ˆìƒ)

[ ] í…ŒìŠ¤íŠ¸ ì¸í”„ë¼ ì„¤ì •
    [ ] í…ŒìŠ¤íŠ¸ íŒŒì¼ëª…: scan-image-storage.with-scans.spec.ts
    [ ] authenticated-with-scans í”„ë¡œì íŠ¸ ì‚¬ìš©
    [ ] testRunId ê¸°ë°˜ ê³ ìœ  ì‹ë³„ì ì‚¬ìš©
    [ ] cleanupTestImages í•¨ìˆ˜ êµ¬í˜„
    [ ] ì§ë ¬ ì‹¤í–‰ ì„¤ì • (test.describe.configure)

[ ] Supabase Storage ì„¤ì •
    [ ] scan-images ë²„í‚· ìƒì„±
    [ ] RLS ì •ì±… ì„¤ì • (INSERT/SELECT/DELETE)
    [ ] íŒŒì¼ í¬ê¸° ì œí•œ (5MB)
    [ ] í—ˆìš© MIME íƒ€ì… ì„¤ì •

[ ] TypeScript íƒ€ì… ì •ì˜
    [ ] ImageUploadParams íƒ€ì…
    [ ] ImageUploadResult íƒ€ì…
    [ ] ImageProcessOptions íƒ€ì…

[ ] ScanImageStorage í´ë˜ìŠ¤
    [ ] uploadScanImage ë©”ì„œë“œ
    [ ] deleteScanImage ë©”ì„œë“œ
    [ ] getPublicUrl ë©”ì„œë“œ
    [ ] base64ToBlob ìœ í‹¸ í•¨ìˆ˜
    [ ] generateImagePath ìœ í‹¸ í•¨ìˆ˜

[ ] Repository ìˆ˜ì •
    [ ] SaveScanParamsì— imageData í•„ë“œ ì¶”ê°€
    [ ] saveScanì—ì„œ ì´ë¯¸ì§€ ì—…ë¡œë“œ ë¡œì§ ì¶”ê°€
    [ ] ì—…ë¡œë“œ ì‹¤íŒ¨ ì‹œ í´ë°± ì²˜ë¦¬

[ ] API ìˆ˜ì •
    [ ] ìš”ì²­ì—ì„œ imageData ì¶”ì¶œ
    [ ] ScanImageStorage ì¸ìŠ¤í„´ìŠ¤ ìƒì„±
    [ ] timings.imageUploadMs ì¶”ê°€

[ ] ì—ëŸ¬ ì²˜ë¦¬
    [ ] ì—…ë¡œë“œ ì‹¤íŒ¨ ì‹œ ìŠ¤ìº” ì €ì¥ ê³„ì† ì§„í–‰
    [ ] ìš©ëŸ‰ ì´ˆê³¼ ì—ëŸ¬ ë©”ì‹œì§€
    [ ] ë¡œê¹… êµ¬í˜„

[ ] í…ŒìŠ¤íŠ¸
    [ ] ì´ë¯¸ì§€ ì—…ë¡œë“œ ì„±ê³µ ê²€ì¦
    [ ] image_url ì €ì¥ ê²€ì¦
    [ ] ì´ë¯¸ì§€ ì—†ì„ ë•Œ null ê²€ì¦
    [ ] ëŒ€ìš©ëŸ‰ ì´ë¯¸ì§€ ê±°ë¶€ ê²€ì¦
