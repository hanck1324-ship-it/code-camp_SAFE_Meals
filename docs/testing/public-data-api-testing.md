# ê³µê³µë°ì´í„° API Playwright í…ŒìŠ¤íŠ¸ ê°€ì´ë“œ

SafeMeals í”„ë¡œì íŠ¸ì˜ ê³µê³µë°ì´í„° API í†µí•©ì„ Playwrightë¡œ í…ŒìŠ¤íŠ¸í•˜ëŠ” ë°©ë²•ì…ë‹ˆë‹¤.

## ğŸ“‹ ëª©ì°¨

1. [í…ŒìŠ¤íŠ¸ ê°œìš”](#í…ŒìŠ¤íŠ¸-ê°œìš”)
2. [í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ë°©ë²•](#í…ŒìŠ¤íŠ¸-ì‹¤í–‰-ë°©ë²•)
3. [í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤](#í…ŒìŠ¤íŠ¸-ì‹œë‚˜ë¦¬ì˜¤)
4. [ê²°ê³¼ í•´ì„](#ê²°ê³¼-í•´ì„)
5. [ë¬¸ì œ í•´ê²°](#ë¬¸ì œ-í•´ê²°)

---

## í…ŒìŠ¤íŠ¸ ê°œìš”

### í…ŒìŠ¤íŠ¸ ëŒ€ìƒ API

1. **HACCP ì œí’ˆì´ë¯¸ì§€ ë° í¬ì¥ì§€í‘œê¸°ì •ë³´**
   - ì§ì ‘ API í˜¸ì¶œ í…ŒìŠ¤íŠ¸
   - ì œí’ˆëª…/ë°”ì½”ë“œ ê²€ìƒ‰ í…ŒìŠ¤íŠ¸

2. **í•œì‹ì§„í¥ì› ë ˆì‹œí”¼ ì¬ë£Œì •ë³´**
   - Header ì¸ì¦ ë°©ì‹ í…ŒìŠ¤íŠ¸
   - ëŒ€ëŸ‰ ë°ì´í„° ì¡°íšŒ í…ŒìŠ¤íŠ¸

3. **í‘¸ë“œQR ì •ë³´ ì„œë¹„ìŠ¤**
   - ê¸°ë³¸ ì¡°íšŒ ë° ê²€ìƒ‰ í…ŒìŠ¤íŠ¸

4. **Next.js API Route**
   - í†µí•© ê²€ìƒ‰ ì—”ë“œí¬ì¸íŠ¸ í…ŒìŠ¤íŠ¸
   - ì—ëŸ¬ ì²˜ë¦¬ í…ŒìŠ¤íŠ¸

### í™˜ê²½ ìš”êµ¬ì‚¬í•­

- âœ… Playwright ì„¤ì¹˜ë¨
- âœ… `.env.local`ì— API í‚¤ ì„¤ì •ë¨
- âœ… ê°œë°œ ì„œë²„ ì‹¤í–‰ ì¤‘ (Next.js API Route í…ŒìŠ¤íŠ¸ìš©)

---

## í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ë°©ë²•

### 1. ê¸°ë³¸ ì‹¤í–‰

**ì „ì²´ í…ŒìŠ¤íŠ¸ ì‹¤í–‰:**
```bash
npx playwright test public-data-api.spec.ts
```

**íŠ¹ì • í…ŒìŠ¤íŠ¸ ê·¸ë£¹ë§Œ ì‹¤í–‰:**
```bash
# HACCP APIë§Œ í…ŒìŠ¤íŠ¸
npx playwright test public-data-api.spec.ts -g "HACCP API í…ŒìŠ¤íŠ¸"

# í•œì‹ì§„í¥ì› APIë§Œ í…ŒìŠ¤íŠ¸
npx playwright test public-data-api.spec.ts -g "í•œì‹ì§„í¥ì› API í…ŒìŠ¤íŠ¸"

# í‘¸ë“œQR APIë§Œ í…ŒìŠ¤íŠ¸
npx playwright test public-data-api.spec.ts -g "í‘¸ë“œQR API í…ŒìŠ¤íŠ¸"

# Next.js API Routeë§Œ í…ŒìŠ¤íŠ¸
npx playwright test public-data-api.spec.ts -g "Next.js API Route í…ŒìŠ¤íŠ¸"
```

---

### 2. UI ëª¨ë“œë¡œ ì‹¤í–‰ (ì‹œê°ì  ë””ë²„ê¹…)

```bash
npx playwright test public-data-api.spec.ts --ui
```

**UI ëª¨ë“œ ì¥ì :**
- ê° í…ŒìŠ¤íŠ¸ë¥¼ ê°œë³„ì ìœ¼ë¡œ ì‹¤í–‰ ê°€ëŠ¥
- ìš”ì²­/ì‘ë‹µì„ ì‹¤ì‹œê°„ìœ¼ë¡œ í™•ì¸
- ì‹¤íŒ¨í•œ í…ŒìŠ¤íŠ¸ë¥¼ ì‰½ê²Œ ë””ë²„ê¹…

---

### 3. ë””ë²„ê·¸ ëª¨ë“œ

```bash
npx playwright test public-data-api.spec.ts --debug
```

---

### 4. Next.js API Route í…ŒìŠ¤íŠ¸ ì „ ê°œë°œ ì„œë²„ ì‹¤í–‰

Next.js API Route í…ŒìŠ¤íŠ¸ë¥¼ ì‹¤í–‰í•˜ë ¤ë©´ ë¨¼ì € ê°œë°œ ì„œë²„ë¥¼ ì‹¤í–‰í•´ì•¼ í•©ë‹ˆë‹¤:

```bash
# í„°ë¯¸ë„ 1: ê°œë°œ ì„œë²„ ì‹¤í–‰
npm run dev

# í„°ë¯¸ë„ 2: Playwright í…ŒìŠ¤íŠ¸ ì‹¤í–‰
npx playwright test public-data-api.spec.ts -g "Next.js API Route í…ŒìŠ¤íŠ¸"
```

---

## í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤

### 1ï¸âƒ£ HACCP API í…ŒìŠ¤íŠ¸

#### ì‹œë‚˜ë¦¬ì˜¤ 1: ê¸°ë³¸ ëª©ë¡ ì¡°íšŒ
```typescript
test('HACCP API: ê¸°ë³¸ ëª©ë¡ ì¡°íšŒ ì„±ê³µ')
```

**ê²€ì¦ í•­ëª©:**
- HTTP ì‘ë‹µ ì„±ê³µ (200 OK)
- `header.resultCode === '00'` (ì •ìƒ)
- `body.items` ë°°ì—´ ì¡´ì¬
- `totalCount` ê°’ í™•ì¸

**ì˜ˆìƒ ì¶œë ¥:**
```
âœ… HACCP API ì„±ê³µ: 1234ê°œ ì œí’ˆ ì¡°íšŒë¨
```

---

#### ì‹œë‚˜ë¦¬ì˜¤ 2: ì œí’ˆëª…ìœ¼ë¡œ ê²€ìƒ‰
```typescript
test('HACCP API: ì œí’ˆëª…ìœ¼ë¡œ ê²€ìƒ‰')
```

**ê²€ìƒ‰ì–´:** "ì½œë¼"

**ê²€ì¦ í•­ëª©:**
- ê²€ìƒ‰ ê²°ê³¼ ì¡´ì¬
- ì œí’ˆëª…, ì œì¡°ì‚¬, ì›ì¬ë£Œ ì •ë³´ í™•ì¸

**ì˜ˆìƒ ì¶œë ¥:**
```
âœ… ì°¾ì€ ì œí’ˆ: {
  ì œí’ˆëª…: "ì½”ì¹´ì½œë¼",
  ì œì¡°ì‚¬: "ì½”ì¹´ì½œë¼ìŒë£Œ(ì£¼)",
  ì›ì¬ë£Œ: "ì •ì œìˆ˜, ì„¤íƒ•, ì´ì‚°í™”íƒ„ì†Œ..."
}
```

---

#### ì‹œë‚˜ë¦¬ì˜¤ 3: ë°”ì½”ë“œ ê²€ìƒ‰ (Skip)
```typescript
test.skip('HACCP API: ë°”ì½”ë“œë¡œ ê²€ìƒ‰')
```

**ìƒíƒœ:** Skip (ì‹¤ì œ í…ŒìŠ¤íŠ¸ìš© ë°”ì½”ë“œ í•„ìš”)

**í™œì„±í™” ë°©ë²•:**
1. ì‹¤ì œ ì œí’ˆ ë°”ì½”ë“œ ë²ˆí˜¸ í™•ë³´
2. `test.skip` â†’ `test`ë¡œ ë³€ê²½
3. `testBarcode` ê°’ ìˆ˜ì •

---

### 2ï¸âƒ£ í•œì‹ì§„í¥ì› API í…ŒìŠ¤íŠ¸

#### ì‹œë‚˜ë¦¬ì˜¤ 1: ì¬ë£Œì •ë³´ ê¸°ë³¸ ì¡°íšŒ
```typescript
test('í•œì‹ì§„í¥ì› API: ì¬ë£Œì •ë³´ ì¡°íšŒ ì„±ê³µ')
```

**ê²€ì¦ í•­ëª©:**
- Header ì¸ì¦ ë°©ì‹ (`Authorization: Infuser {KEY}`)
- í˜ì´ì§€ë„¤ì´ì…˜ ì •ë³´ (`page`, `perPage`, `totalCount`)
- ë°ì´í„° ë°°ì—´ ë°˜í™˜

**ì˜ˆìƒ ì¶œë ¥:**
```
âœ… í•œì‹ì§„í¥ì› API ì„±ê³µ: {
  ì´_ë°ì´í„°ìˆ˜: 5234,
  ì²«ë²ˆì§¸_í•­ëª©: {
    ë ˆì‹œí”¼ëª…: "ê¹€ì¹˜ì°Œê°œ",
    ì¬ë£Œëª…: "ë¼ì§€ê³ ê¸°",
    ì¬ë£Œë¶„ë¥˜: "ìœ¡ë¥˜"
  }
}
```

---

#### ì‹œë‚˜ë¦¬ì˜¤ 2: ëŒ€ëŸ‰ ë°ì´í„° ì¡°íšŒ
```typescript
test('í•œì‹ì§„í¥ì› API: ëŒ€ëŸ‰ ë°ì´í„° ì¡°íšŒ (100ê°œ)')
```

**ê²€ì¦ í•­ëª©:**
- ìµœëŒ€ 100ê°œê¹Œì§€ ì¡°íšŒ ê°€ëŠ¥
- ë°ì´í„° ê°œìˆ˜ í™•ì¸

---

### 3ï¸âƒ£ í‘¸ë“œQR API í…ŒìŠ¤íŠ¸

#### ì‹œë‚˜ë¦¬ì˜¤ 1: ê¸°ë³¸ ëª©ë¡ ì¡°íšŒ
```typescript
test('í‘¸ë“œQR API: ê¸°ë³¸ ëª©ë¡ ì¡°íšŒ ì„±ê³µ')
```

**ê²€ì¦ í•­ëª©:**
- HACCP APIì™€ ìœ ì‚¬í•œ ì‘ë‹µ êµ¬ì¡°
- `resultCode === '00'` í™•ì¸

---

#### ì‹œë‚˜ë¦¬ì˜¤ 2: ì œí’ˆëª… ê²€ìƒ‰
```typescript
test('í‘¸ë“œQR API: ì œí’ˆëª…ìœ¼ë¡œ ê²€ìƒ‰')
```

**ê²€ìƒ‰ì–´:** "ì‚¬ì´ë‹¤"

---

### 4ï¸âƒ£ Next.js API Route í…ŒìŠ¤íŠ¸

#### í†µí•© ê²€ìƒ‰ ì—”ë“œí¬ì¸íŠ¸ í…ŒìŠ¤íŠ¸

**ì—”ë“œí¬ì¸íŠ¸:** `GET /api/test/public-data`

**í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤:**

1. **HACCP í…ŒìŠ¤íŠ¸**
   ```
   GET /api/test/public-data?api=haccp
   ```

2. **í•œì‹ì§„í¥ì› í…ŒìŠ¤íŠ¸**
   ```
   GET /api/test/public-data?api=korean-food
   ```

3. **í‘¸ë“œQR í…ŒìŠ¤íŠ¸**
   ```
   GET /api/test/public-data?api=food-qr
   ```

4. **ë°”ì½”ë“œ í†µí•© ê²€ìƒ‰**
   ```
   GET /api/test/public-data?api=search-barcode&barcode=8801234567890
   ```

5. **ì œí’ˆëª… í†µí•© ê²€ìƒ‰**
   ```
   GET /api/test/public-data?api=search-name&name=ì½œë¼
   ```

---

### 5ï¸âƒ£ ì—ëŸ¬ ì²˜ë¦¬ í…ŒìŠ¤íŠ¸

#### ì‹œë‚˜ë¦¬ì˜¤ 1: ì˜ëª»ëœ ì¸ì¦í‚¤
```typescript
test('ì˜ëª»ëœ ì¸ì¦í‚¤ë¡œ ìš”ì²­ ì‹œ ì—ëŸ¬ ë°˜í™˜')
```

**ê²€ì¦ í•­ëª©:**
- `resultCode !== '00'`
- ì—ëŸ¬ ë©”ì‹œì§€ í™•ì¸

---

#### ì‹œë‚˜ë¦¬ì˜¤ 2: ì˜ëª»ëœ API íŒŒë¼ë¯¸í„°
```typescript
test('Next.js API: ì˜ëª»ëœ api íŒŒë¼ë¯¸í„°')
```

**ì˜ˆìƒ ê²°ê³¼:**
- HTTP 400 Bad Request
- `error` í•„ë“œ ì¡´ì¬

---

#### ì‹œë‚˜ë¦¬ì˜¤ 3: í•„ìˆ˜ íŒŒë¼ë¯¸í„° ëˆ„ë½
```typescript
test('Next.js API: barcode íŒŒë¼ë¯¸í„° ëˆ„ë½')
```

**ì˜ˆìƒ ê²°ê³¼:**
- HTTP 400 Bad Request
- ì—ëŸ¬ ë©”ì‹œì§€: "barcode parameter is required"

---

## ê²°ê³¼ í•´ì„

### âœ… ì„±ê³µ ì¼€ì´ìŠ¤

```bash
  âœ“ HACCP API: ê¸°ë³¸ ëª©ë¡ ì¡°íšŒ ì„±ê³µ (1.2s)
  âœ“ í•œì‹ì§„í¥ì› API: ì¬ë£Œì •ë³´ ì¡°íšŒ ì„±ê³µ (0.8s)
  âœ“ í‘¸ë“œQR API: ê¸°ë³¸ ëª©ë¡ ì¡°íšŒ ì„±ê³µ (1.5s)

  3 passed (3.5s)
```

**ì˜ë¯¸:**
- ëª¨ë“  API í‚¤ê°€ ì •ìƒ ì‘ë™
- ë„¤íŠ¸ì›Œí¬ ì—°ê²° ì •ìƒ
- API ì„œë²„ ì •ìƒ ìš´ì˜ ì¤‘

---

### âŒ ì‹¤íŒ¨ ì¼€ì´ìŠ¤

#### ì‹¤íŒ¨ 1: ì¸ì¦ ì˜¤ë¥˜
```bash
  âœ— HACCP API: ê¸°ë³¸ ëª©ë¡ ì¡°íšŒ ì„±ê³µ
    Error: resultCode '30' (ì¸ì¦í‚¤ê°€ ìœ íš¨í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤)
```

**í•´ê²° ë°©ë²•:**
1. `.env.local`ì—ì„œ API í‚¤ í™•ì¸
2. ê³µê³µë°ì´í„°í¬í„¸ì—ì„œ í‚¤ ì¬ë°œê¸‰
3. ì¸ì½”ë”©/ë””ì½”ë”© í‚¤ ì¤‘ ì˜¬ë°”ë¥¸ ê²ƒ ì‚¬ìš©

---

#### ì‹¤íŒ¨ 2: ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜
```bash
  âœ— HACCP API: ê¸°ë³¸ ëª©ë¡ ì¡°íšŒ ì„±ê³µ
    Error: getaddrinfo ENOTFOUND apis.data.go.kr
```

**í•´ê²° ë°©ë²•:**
- ì¸í„°ë„· ì—°ê²° í™•ì¸
- VPN ë˜ëŠ” ë°©í™”ë²½ ì„¤ì • í™•ì¸

---

#### ì‹¤íŒ¨ 3: Next.js API Route ì˜¤ë¥˜
```bash
  âœ— Next.js API: HACCP í…ŒìŠ¤íŠ¸
    Error: connect ECONNREFUSED 127.0.0.1:3000
```

**í•´ê²° ë°©ë²•:**
- ê°œë°œ ì„œë²„ ì‹¤í–‰ í™•ì¸ (`npm run dev`)
- í¬íŠ¸ 3000ì´ ì‚¬ìš© ì¤‘ì¸ì§€ í™•ì¸

---

## ë¬¸ì œ í•´ê²°

### ë¬¸ì œ 1: "SERVICE_KEY_IS_NOT_REGISTERED_ERROR"

**ì›ì¸:** ì¸ì¦í‚¤ê°€ ë“±ë¡ë˜ì§€ ì•Šì•˜ê±°ë‚˜ ì˜ëª»ë¨

**í•´ê²°:**
```bash
# .env.local í™•ì¸
PUBLIC_DATA_KEY="ì˜¬ë°”ë¥¸í‚¤"
HACCP_API_KEY="ì˜¬ë°”ë¥¸í‚¤"

# í™˜ê²½ë³€ìˆ˜ ë‹¤ì‹œ ë¡œë“œ
# (ê°œë°œ ì„œë²„ ì¬ì‹œì‘)
```

---

### ë¬¸ì œ 2: "NORMAL_CODE-00" ì´ì§€ë§Œ ë°ì´í„°ê°€ ë¹„ì–´ìˆìŒ

**ì›ì¸:** ê²€ìƒ‰ ì¡°ê±´ì— ë§ëŠ” ë°ì´í„°ê°€ ì—†ìŒ

**í•´ê²°:**
- ê²€ìƒ‰ì–´ ë³€ê²½
- í˜ì´ì§€ ë²ˆí˜¸ í™•ì¸
- `totalCount` ê°’ í™•ì¸

---

### ë¬¸ì œ 3: Next.js API Routeê°€ 404 ì—ëŸ¬

**ì›ì¸:** API Route íŒŒì¼ì´ ì—†ê±°ë‚˜ ê²½ë¡œ ì˜¤ë¥˜

**í™•ì¸:**
```bash
ls apps/web/src/app/api/test/public-data/route.ts
```

**í•´ê²°:**
- íŒŒì¼ ì¡´ì¬ í™•ì¸
- ê°œë°œ ì„œë²„ ì¬ì‹œì‘

---

### ë¬¸ì œ 4: Playwright í…ŒìŠ¤íŠ¸ê°€ ë„ˆë¬´ ëŠë¦¼

**ì›ì¸:** API í˜¸ì¶œ ì‹œê°„ì´ ê¹€

**í•´ê²°:**
```bash
# íƒ€ì„ì•„ì›ƒ ì¦ê°€
npx playwright test public-data-api.spec.ts --timeout=60000
```

---

## ì¶”ê°€ íŒ

### 1. íŠ¹ì • í…ŒìŠ¤íŠ¸ë§Œ ì‹¤í–‰í•˜ê³  ì‹¶ì„ ë•Œ

`test.only()`ë¥¼ ì‚¬ìš©í•˜ì„¸ìš”:
```typescript
test.only('HACCP API: ê¸°ë³¸ ëª©ë¡ ì¡°íšŒ ì„±ê³µ', async ({ request }) => {
  // ...
});
```

---

### 2. ì½˜ì†” ì¶œë ¥ ë³´ê¸°

```bash
npx playwright test public-data-api.spec.ts --reporter=list
```

---

### 3. HTML ë¦¬í¬íŠ¸ ìƒì„±

```bash
npx playwright test public-data-api.spec.ts --reporter=html
```

ê·¸ ë‹¤ìŒ:
```bash
npx playwright show-report
```

---

## ë‹¤ìŒ ë‹¨ê³„

- [ ] ì‹¤ì œ ë°”ì½”ë“œë¡œ ê²€ìƒ‰ í…ŒìŠ¤íŠ¸ í™œì„±í™”
- [ ] API ì‘ë‹µ ìºì‹± í…ŒìŠ¤íŠ¸ ì¶”ê°€
- [ ] ì„±ëŠ¥ í…ŒìŠ¤íŠ¸ (ëŒ€ëŸ‰ ìš”ì²­)
- [ ] CI/CD íŒŒì´í”„ë¼ì¸ì— í†µí•©

---

**ì‘ì„±ì¼:** 2026-01-02
**ë²„ì „:** 1.0.0
**ë‹´ë‹¹ì:** SafeMeals ê°œë°œíŒ€
