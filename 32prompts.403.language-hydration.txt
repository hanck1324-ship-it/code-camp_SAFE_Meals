ì•„ë˜ì˜ ì¡°ê±´ì„ ëª¨ë‘ ì ìš©í•˜ì—¬, ì•„ë˜ì˜ ìš”êµ¬ì‚¬í•­ì„ ëª¨ë‘ êµ¬í˜„í•  ê²ƒ.
êµ¬í˜„ ê²°ê³¼ë¥¼ ì²´í¬ë¦¬ìŠ¤íŠ¸ë¡œ ë°˜í™˜í•  ê²ƒ.

==============================================

ì¡°ê±´-ì»¤ì„œë£°) ì•„ë˜ì˜ ì»¤ì„œë£°ì„ ì ìš©í•˜ì—¬ ì‘ì—…í•˜ê³ , ì´ ì‘ì—…ì´ ëë‚˜ë©´ í•´ë‹¹ rules ì ìš© ê²°ê³¼ë¥¼ ì²´í¬ë¦¬ìŠ¤íŠ¸ë¡œ ë°˜í™˜í•  ê²ƒ.
            - @01-common.mdc
            - @04-func.mdc

==============================================

ì¡°ê±´-íŒŒì¼ê²½ë¡œ) ìˆ˜ì •ë  HOOK íŒŒì¼ê²½ë¡œ: apps/web/src/commons/stores/useLanguageStore.ts
ì¡°ê±´-íŒŒì¼ê²½ë¡œ) êµ¬í˜„ë  TEST íŒŒì¼ê²½ë¡œ: apps/web/src/commons/stores/tests/useLanguageStore.spec.ts

==============================================

í•µì‹¬ìš”êµ¬ì‚¬í•­) playwright í…ŒìŠ¤íŠ¸ë¥¼ í™œìš©í•˜ì—¬ TDD ê¸°ë°˜ìœ¼ë¡œ êµ¬í˜„í•˜ê³ , í…ŒìŠ¤íŠ¸ì— í†µê³¼í•  ë•Œê¹Œì§€ ë°˜ë³µí•  ê²ƒ.

1) í…ŒìŠ¤íŠ¸ ì œì™¸ ë¼ì´ë¸ŒëŸ¬ë¦¬
   - jest
   - @testing-library/react

2) í…ŒìŠ¤íŠ¸ ì¡°ê±´
   - timeoutì€ ì„¤ì •í•˜ì§€ ì•Šê±°ë‚˜, 500ms ë¯¸ë§Œìœ¼ë¡œ ì„¤ì •í•  ê²ƒ.
   - í˜ì´ì§€ê°€ ì™„ì „íˆ ë¡œë“œëœ í›„ í…ŒìŠ¤íŠ¸í•  ê²ƒ.
       - í˜ì´ì§€ ë¡œë“œ ì‹ë³„ ìš”êµ¬ì‚¬í•­: ê³ ì •ì‹ë³„ì data-testid ëŒ€ê¸° ë°©ë²•
       - **ì¤‘ìš”ê¸ˆì§€ì‚¬í•­** í˜ì´ì§€ ë¡œë“œ ì‹ë³„ ê¸ˆì§€ì‚¬í•­: networkidle ëŒ€ê¸° ë°©ë²•

3) í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤
   3-1) ì„±ê³µ ì‹œë‚˜ë¦¬ì˜¤
        - localStorageì— persist í¬ë§·ìœ¼ë¡œ 'en' ì €ì¥:
          localStorage.setItem('safemeals-language-storage', JSON.stringify({
            state: { language: 'en' },
            version: 0
          }))
        - í˜ì´ì§€ ë¡œë“œ í›„ í•´ë‹¹ ì–¸ì–´ë¡œ ë¡œë“œë˜ëŠ”ì§€ ê²€ì¦
        - hydrated ìƒíƒœê°€ trueì¸ì§€ ê²€ì¦ (hydration ì™„ë£Œ í›„)
        - ì–¸ì–´ ë³€ê²½(setLanguage) ì‹œ localStorageê°€ ì—…ë°ì´íŠ¸ë˜ëŠ”ì§€ ê²€ì¦
        - í˜ì´ì§€ì—ì„œ useTranslation í›… ì‚¬ìš© ì‹œ hydration ì™„ë£Œ í›„ ì˜¬ë°”ë¥¸ ë²ˆì—­ì´ í‘œì‹œë˜ëŠ”ì§€ ê²€ì¦

   3-2) ì‹¤íŒ¨/ì—£ì§€ ì‹œë‚˜ë¦¬ì˜¤
        - localStorageê°€ ë¹„ì–´ìˆì„ ë•Œ ê¸°ë³¸ ì–¸ì–´(ko)ë¡œ ì‹œì‘í•˜ëŠ”ì§€ ê²€ì¦
        - localStorageì— ì˜ëª»ëœ í¬ë§·ì´ ì €ì¥ëœ ê²½ìš° ê¸°ë³¸ ì–¸ì–´(ko)ë¡œ fallbackí•˜ëŠ”ì§€ ê²€ì¦
        - ì½”ë“œìƒ hydrated ì´ˆê¸°ê°’ì´ falseì¸ì§€ í™•ì¸ (ëŸ°íƒ€ì„ false ê´€ì¸¡ì€ ë§¤ìš° ë¹ ë¥¸ hydrationìœ¼ë¡œ ì¸í•´ ë¶ˆì•ˆì •)

==============================================

í•µì‹¬ìš”êµ¬ì‚¬í•­) useLanguageStoreì— zustand persist hydration ì™„ë£Œ ìƒíƒœë¥¼ ì¶”ê°€í•  ê²ƒ.

1) íŒŒì¼ ìµœìƒë‹¨ì— 'use client' ì§€ì‹œì–´ ì¶”ê°€ (Next.js SSR ëŒ€ì‘)

2) ì¶”ê°€í•  ìƒíƒœ ë° í•¨ìˆ˜
   interface LanguageState {
     language: Language;
     setLanguage: (lang: Language) => void;
     hydrated: boolean; // ì¶”ê°€
   }

3) hydration ì™„ë£Œ ê°ì§€ êµ¬í˜„
   3-1) zustand persistì˜ onRehydrateStorage ì½œë°± ì‚¬ìš©
   3-2) persist ë¯¸ë“¤ì›¨ì–´ ì„¤ì •ì— ë‹¤ìŒ ì¶”ê°€:
        {
          name: 'safemeals-language-storage',
          storage: createJSONStorage(() => localStorage),
          partialize: (state) => ({ language: state.language }), // ğŸ”¥ hydratedëŠ” persist ì œì™¸
          onRehydrateStorage: () => (state) => {
            // ğŸ”¥ hydration ì™„ë£Œ ì‹œ setStateë¡œ hydratedë¥¼ trueë¡œ ì„¤ì •
            useLanguageStore.setState({ hydrated: true });
          }
        }

4) ì´ˆê¸° ìƒíƒœ ì„¤ì •
   4-1) hydrated ì´ˆê¸°ê°’: false
   4-2) localStorageì— ì €ì¥ëœ ì–¸ì–´ê°€ ìœ íš¨í•˜ì§€ ì•Šìœ¼ë©´ ê¸°ë³¸ê°’('ko') ì‚¬ìš©

5) **ì¤‘ìš”ê¸ˆì§€ì‚¬í•­**: state.hydrated = true ê°™ì€ ì§ì ‘ mutation ê¸ˆì§€
   - ë°˜ë“œì‹œ useLanguageStore.setState({ hydrated: true }) ì‚¬ìš©

6) ì»´í¬ë„ŒíŠ¸ì—ì„œ ì‚¬ìš© ì˜ˆì‹œ
   const { language, hydrated } = useLanguageStore();

   if (!hydrated) {
     return <div>Loading...</div>; // hydration ëŒ€ê¸°
   }

   // hydration ì™„ë£Œ í›„ ë Œë”ë§
   return <div>{t.someText}</div>;

7) ìœ íš¨ì„± ê²€ì¦
   7-1) language ê°’ì´ Language íƒ€ì…('ko' | 'en' | 'ja' | 'zh' | 'es')ì— ì†í•˜ëŠ”ì§€ í™•ì¸
   7-2) ìœ íš¨í•˜ì§€ ì•Šìœ¼ë©´ 'ko'ë¡œ ì„¤ì •

8) í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ ì˜ˆì‹œ
   8-1) ì„±ê³µ ì¼€ì´ìŠ¤
        - localStorageì— persist í¬ë§·ìœ¼ë¡œ ì €ì¥:
          localStorage.setItem('safemeals-language-storage', JSON.stringify({
            state: { language: 'en' },
            version: 0
          }))
        - í˜ì´ì§€ ë¡œë“œ í›„ language === 'en', hydrated === true í™•ì¸
        - setLanguage('ja') í˜¸ì¶œ â†’ localStorage ì—…ë°ì´íŠ¸ ë° language === 'ja' í™•ì¸

   8-2) ì‹¤íŒ¨/ì—£ì§€ ì¼€ì´ìŠ¤
        - localStorage ë¹„ì–´ìˆìŒ â†’ language === 'ko', hydrated === true
        - localStorageì— ì˜ëª»ëœ í¬ë§· ì €ì¥ â†’ language === 'ko', hydrated === true (fallback)
        - ì½”ë“œìƒ ì´ˆê¸°ê°’ í™•ì¸: hydrated ì´ˆê¸°ê°’ì´ falseì¸ì§€ ê²€ì¦ (ëŸ°íƒ€ì„ ê´€ì¸¡ì€ ë¶ˆì•ˆì •)

==============================================

í•µì‹¬ìš”êµ¬ì‚¬í•­) ìˆ˜ì •ëœ useLanguageStoreë¥¼ ì‚¬ìš©í•˜ëŠ” í˜ì´ì§€ë“¤ì´ hydration ëŒ€ê¸° ë¡œì§ì„ êµ¬í˜„í•  ìˆ˜ ìˆë„ë¡ ë¬¸ì„œí™”í•  ê²ƒ.

1) ì‚¬ìš© ê°€ì´ë“œ (ì£¼ì„ ë˜ëŠ” README)
   /**
    * useLanguageStore - zustand persist ê¸°ë°˜ ì–¸ì–´ ìƒíƒœ ê´€ë¦¬
    *
    * @property {Language} language - í˜„ì¬ ì„ íƒëœ ì–¸ì–´ ('ko' | 'en' | 'ja' | 'zh' | 'es')
    * @property {boolean} hydrated - localStorage hydration ì™„ë£Œ ì—¬ë¶€
    * @property {Function} setLanguage - ì–¸ì–´ ë³€ê²½ í•¨ìˆ˜
    *
    * @example
    * // í˜ì´ì§€ì—ì„œ hydration ëŒ€ê¸°
    * const { language, hydrated } = useLanguageStore();
    * const { t } = useTranslation();
    *
    * if (!hydrated) {
    *   return <div>Loading...</div>;
    * }
    *
    * return <div>{t.title}</div>;
    */

2) ì ìš© ëŒ€ìƒ í˜ì´ì§€
   - apps/web/src/app/scan/page.tsx
   - apps/web/src/app/profile/settings/page.tsx
   - apps/web/src/app/profile/safety-card/page.tsx
   - (ê¸°íƒ€ useTranslationì„ ì‚¬ìš©í•˜ëŠ” ëª¨ë“  í˜ì´ì§€)

3) ì ìš© íŒ¨í„´
   3-1) hydrated ìƒíƒœ í™•ì¸
   3-2) hydrated === falseì¼ ë•Œ ë¡œë”© UI í‘œì‹œ
   3-3) hydrated === trueì¼ ë•Œ ì •ìƒ ë Œë”ë§
