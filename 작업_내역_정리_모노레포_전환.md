# 모노레포 전환 및 프로젝트 정리 작업 내역

> **작성일**: 2025-12-23  
> **작업 범위**: 모노레포 구조 전환, 공통 룰 통합, 레거시 파일 정리

---

## 📋 작업 개요

SafeMeals 프로젝트를 모노레포 구조로 전환하고, 공통 룰 파일을 통합하며, 레거시 설정 파일을 정리했습니다.

---

## 1. 공통 룰 파일 통합 및 간소화

### 1.1 파일 통합

**통합 전**: 20개 파일
- `00-quick-reference.mdc`
- `01-common.mdc`, `02-wireframe.mdc`, `03-ui.mdc`
- `04-func.mdc`, `05-func.role.mdc`
- `06-project-specific.mdc`
- `recheck.*.mdc` (7개 파일)

**통합 후**: 8개 파일 (핵심 4개 + 참고 4개)

#### 핵심 가이드 파일 (4개)

1. **`project-guide.mdc`** (alwaysApply: true)
   - 기존: `00-quick-reference.mdc` + `06-project-specific.mdc`
   - 내용: 프로젝트 구조, 기술 스택, 핵심 규칙, 브릿지 프로토콜, 개발 가이드
   - 특징: 모노레포 구조 상세 설명 포함

2. **`common-guide.mdc`**
   - 기존: `01-common.mdc` + `02-wireframe.mdc` + `03-ui.mdc`
   - 내용: 공통 조건, 스타일링 조건, UI 컴포넌트 조건

3. **`func-guide.mdc`**
   - 기존: `04-func.mdc` + `05-func.role.mdc`
   - 내용: 기능 개발 가이드 (JS, API, 폼, 테스트, 권한)

4. **`recheck-guide.mdc`** (새로 생성)
   - 기존: `recheck.*.mdc` (7개 파일 통합)
   - 내용: 작업 완료 후 검토 가이드

#### 참고 파일 (4개)

5. **`migration-guide.mdc`** - Next.js 14 마이그레이션 가이드 (참고용)
6. **`01-refactoring-guide.mdc`** - 리팩토링 가이드
7. **`02-prompt-templates.mdc`** - 프롬프트 템플릿
8. **`README.md`, `EXAMPLES.md`** - 문서

### 1.2 파일 이름 변경

- `00-quick-reference.mdc` → **`project-guide.mdc`** (더 명확한 이름)

### 1.3 통합된 원본 파일 처리

모든 통합된 원본 파일들 (`01-05.mdc`, `recheck.*.mdc`)은 삭제되었고, 통합 안내만 남겨두었습니다.

---

## 2. 개발 의도 문서 업데이트

### 2.1 `개발_의도_및_목적.md` 업데이트

모노레포 하이브리드 구조에 맞게 문서를 전면 수정:

#### 추가된 내용

1. **모노레포 하이브리드 아키텍처 섹션**
   - React Native 네이티브 쉘 + Next.js 웹뷰 구조 설명
   - 웹 앱과 모바일 앱의 역할 구분
   - 공유 패키지(`packages/shared`)의 역할

2. **브릿지 프로토콜 의도 설명**
   - 웹뷰 ↔ 네이티브 통신의 의도와 구현 방식
   - 타입 안전한 브릿지 프로토콜의 장점
   - 사용 예시 코드 추가

3. **화면별 구현 방식 선택 전략**
   - 네이티브 vs 웹뷰 선택 기준
   - 화면별 구현 방식 테이블
   - 선택 기준 명시

4. **실시간 메뉴 분석 플로우 업데이트**
   - 네이티브 카메라 → 브릿지 → 웹뷰 분석 → 결과 표시 플로우
   - 하이브리드 구조의 장점 설명

5. **폴더 구조 업데이트**
   - 모노레포 구조로 전체 폴더 구조 반영

---

## 3. 가이드 문서 이동 및 통합

### 3.1 `.cursor/rules`로 이동

- `MIGRATION_GUIDE.md` → `.cursor/rules/migration-guide.mdc`
- `MONOREPO_GUIDE.md` → `.cursor/rules/project-guide.mdc`에 통합

### 3.2 원본 파일 삭제

- `MIGRATION_GUIDE.md` 삭제
- `MONOREPO_GUIDE.md` 삭제 (내용은 `project-guide.mdc`에 통합)

---

## 4. 모노레포 구조 전환 작업

### 4.1 레거시 파일 제거

#### 루트 레벨 레거시 파일
- ✅ `index.html` 제거 (Vite 레거시)
- ✅ `package-lock.json` 제거 (npm 레거시, pnpm 사용)

#### 앱 레벨 레거시 파일
- ✅ `apps/mobile/package-lock.json` 제거 (npm 레거시)

### 4.2 설정 파일 수정

#### `apps/web/tsconfig.json`
- 레거시 파일 참조 제거 (`vite.config.ts`, `src/main.tsx`, `src/App.tsx`)

#### `apps/web/playwright.config.ts`
- `npm run dev` → `pnpm dev`로 변경

### 4.3 패키지 매니저 확인

#### 현재 상태
- ✅ 루트 `package.json`: `"packageManager": "pnpm@8.15.0"` 명시
- ✅ `pnpm-lock.yaml` 존재 (pnpm 사용)
- ✅ `pnpm-workspace.yaml` 설정 완료
- ✅ 모든 스크립트: `pnpm` 명령어 사용

#### pnpm 사용 이유
1. **모노레포 지원**: workspace 기능이 안정적
2. **디스크 공간 효율**: 심볼릭 링크로 중복 패키지 제거
3. **설치 속도**: 병렬 설치와 캐싱으로 빠른 설치
4. **엄격한 의존성 관리**: phantom dependencies 방지

---

## 5. 프로젝트 구조 정리

### 5.1 최종 모노레포 구조

```
safemeals-monorepo/
├── apps/
│   ├── web/                    # Next.js 웹앱 (웹뷰용)
│   │   ├── src/
│   │   │   ├── app/            # Next.js App Router
│   │   │   ├── features/       # 기능별 모듈
│   │   │   ├── components/     # 공통 컴포넌트
│   │   │   ├── commons/        # 전역 레이아웃, 상수, 스토어
│   │   │   ├── lib/            # 유틸리티
│   │   │   └── hooks/          # 커스텀 훅
│   │   ├── public/
│   │   ├── next.config.js
│   │   ├── tailwind.config.ts
│   │   ├── postcss.config.js
│   │   ├── playwright.config.ts
│   │   └── package.json
│   │
│   └── mobile/                 # React Native 네이티브 앱
│       ├── app/                # Expo Router 파일 기반 라우팅
│       ├── components/         # 네이티브 컴포넌트 (WebViewScreen 등)
│       ├── android/
│       ├── ios/
│       ├── babel.config.js
│       ├── tsconfig.json
│       └── package.json
│
├── packages/
│   └── shared/                 # 공유 패키지
│       ├── src/
│       │   ├── bridge-protocol/# 웹뷰-네이티브 통신
│       │   ├── types/          # 공통 타입
│       │   └── constants/      # 공통 상수
│       ├── package.json
│       └── tsconfig.json
│
├── .cursor/
│   └── rules/                  # Cursor 룰 파일
│       ├── project-guide.mdc
│       ├── common-guide.mdc
│       ├── func-guide.mdc
│       ├── recheck-guide.mdc
│       └── migration-guide.mdc
│
├── pnpm-workspace.yaml
├── pnpm-lock.yaml
└── package.json
```

### 5.2 설정 파일 위치

#### 웹 앱 (`apps/web`)
- ✅ `next.config.js` - Next.js 설정
- ✅ `tsconfig.json` - TypeScript 설정
- ✅ `tailwind.config.ts` - Tailwind CSS 설정
- ✅ `postcss.config.js` - PostCSS 설정
- ✅ `playwright.config.ts` - Playwright 테스트 설정

#### 모바일 앱 (`apps/mobile`)
- ✅ `package.json` - 패키지 의존성
- ✅ `tsconfig.json` - TypeScript 설정
- ✅ `babel.config.js` - Babel 설정
- ✅ `app.json` - Expo 설정

#### 공유 패키지 (`packages/shared`)
- ✅ `package.json` - 패키지 의존성
- ✅ `tsconfig.json` - TypeScript 설정

---

## 6. 검증 및 테스트

### 6.1 완료된 작업

- ✅ 레거시 파일 제거 (index.html, package-lock.json)
- ✅ 설정 파일 수정 (tsconfig.json, playwright.config.ts)
- ✅ 의존성 설치 테스트 (`pnpm install`) - 성공
- ✅ 패키지 매니저 통일 (pnpm)

### 6.2 남은 작업

- ⏳ 개발 서버 실행 테스트 (`pnpm dev:web`)
- ⏳ 빌드 테스트 (`pnpm build:web`)

---

## 7. 발견된 이슈 및 개선 사항

### 7.1 프로필 vs 설정 탭 구조

**현재 문제점:**
- 프로필(웹뷰)과 설정(네이티브)에 기능 중복
  - 언어 설정: 둘 다 존재
  - 알림 설정: 둘 다 존재
  - 로그아웃: 둘 다 존재
- 구현 방식 불일치 (웹뷰 vs 네이티브)

**개선 방안:**
- **방안 1 (권장)**: 역할 분리
  - 프로필: 사용자 정보 중심 (Safety Profile, Safety Card)
  - 설정: 앱 설정 중심 (알림, 언어, 다크 모드, 로그아웃)
- **방안 2**: 통합 (프로필 탭 하나로 통합)

---

## 8. 최종 결과

### 8.1 파일 구조

**이전**: 20개 룰 파일 + 여러 가이드 문서  
**현재**: 8개 룰 파일 (핵심 4개 + 참고 4개)

### 8.2 모노레포 구조

- ✅ pnpm workspace 설정 완료
- ✅ 레거시 파일 정리 완료
- ✅ 설정 파일 모노레포 구조에 맞게 수정 완료
- ✅ 의존성 설치 성공

### 8.3 문서화

- ✅ 공통 룰 통합 및 간소화
- ✅ 개발 의도 문서 업데이트
- ✅ 가이드 문서 `.cursor/rules`로 이동

---

## 9. 다음 단계

1. **프로필/설정 구조 개선** (역할 분리 또는 통합)
2. **개발 서버 실행 테스트** (`pnpm dev:web`)
3. **빌드 테스트** (`pnpm build:web`)
4. **모바일 앱 실행 테스트** (`pnpm dev:mobile`)

---

**작성일**: 2025-12-23  
**작성자**: AI Assistant

