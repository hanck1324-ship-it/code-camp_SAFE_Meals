# SafeMeals 개발 의도 및 목적

> **프로젝트**: SafeMeals - 알레르기 정보 관리 및 메뉴 스캔 앱  
> **작성일**: 2025-12-19

---

## 🎯 핵심 목적

### 1. 사용자 문제 해결

**문제 상황:**
- 알레르기가 있는 사람들이 외식 시 안전한 메뉴를 찾기 어려움
- 언어 장벽으로 인해 레스토랑 직원과 소통이 어려움
- 메뉴판을 보고 알레르기 유발 성분을 직접 확인해야 하는 불편함

**해결책:**
- ✅ **메뉴 스캔 기능**: 카메라로 메뉴판을 촬영하면 AI가 자동으로 알레르기 정보 분석
- ✅ **Safety Card**: PIN으로 보호된 알레르기 정보 카드 (한국어/영어 병기)
- ✅ **다국어 지원**: 5개 언어 지원으로 전 세계 어디서나 사용 가능
- ✅ **실시간 분석**: Gemini AI로 즉시 위험도 판단 (Safe/Caution/Warning/Danger)

---

## 🏗️ 기술적 개발 의도

### 1. 모노레포 하이브리드 아키텍처

**의도:**
```
React Native 네이티브 쉘 + Next.js 웹뷰 하이브리드 앱
→ 각 플랫폼의 장점을 최대한 활용
```

**구조:**
```
safemeals-monorepo/
├── apps/
│   ├── web/              # Next.js 웹 앱 (웹뷰로 사용)
│   └── mobile/           # React Native 네이티브 앱 (Expo)
└── packages/
    └── shared/           # 공유 타입 및 브릿지 프로토콜
```

**구현:**
- **웹 앱 (apps/web)**: 복잡한 UI, 빠른 업데이트가 필요한 화면
  - 대시보드, 온보딩, 프로필, 스캔 결과 등
  - Next.js 14 App Router, Tailwind CSS, shadcn/ui
- **모바일 앱 (apps/mobile)**: 네이티브 기능이 필요한 화면
  - 카메라 스캔, 설정, 권한 관리 등
  - Expo Router, React Native, react-native-webview
- **공유 패키지 (packages/shared)**: 웹과 모바일 간 타입 및 브릿지 프로토콜 공유

**장점:**
- ✅ **빠른 개발**: 웹 기술로 복잡한 UI 빠르게 구현
- ✅ **네이티브 성능**: 카메라 등 네이티브 기능 직접 접근
- ✅ **코드 공유**: 타입과 브릿지 프로토콜 공유로 일관성 유지
- ✅ **독립 배포**: 웹뷰는 서버 업데이트로 즉시 반영 가능

### 2. 브릿지 프로토콜 (웹뷰 ↔ 네이티브 통신)

**의도:**
```
웹뷰와 네이티브 간 안전하고 타입 안전한 통신
→ 각 플랫폼의 기능을 최대한 활용
```

**구현:**
- `packages/shared/src/bridge-protocol` - 타입 안전한 브릿지 프로토콜
- 웹에서 네이티브 호출: `nativeBridge.scanBarcode()`, `nativeBridge.navigate()`
- 네이티브에서 웹뷰로 메시지: WebViewScreen의 handleMessage
- TypeScript로 타입 안전성 보장

**사용 예시:**
```typescript
// 웹뷰에서 네이티브 카메라 호출
import { nativeBridge, isNativeApp } from '@safemeals/shared/bridge-protocol';
if (isNativeApp()) {
  nativeBridge.scanBarcode();
}
```

**장점:**
- ✅ **타입 안전성**: TypeScript로 통신 메시지 타입 보장
- ✅ **유연성**: 웹과 네이티브 기능을 자유롭게 조합
- ✅ **확장성**: 새로운 브릿지 메시지 추가가 용이

### 3. 화면별 구현 방식 선택

**의도:**
```
각 화면의 특성에 맞는 최적의 구현 방식 선택
→ 성능과 개발 효율의 균형
```

**구현 전략:**

| 화면 | 구현 방식 | 이유 |
|------|----------|------|
| 카메라/스캔 | 네이티브 | 카메라 접근, 성능 최적화 |
| 대시보드 | 웹뷰 | 복잡한 UI, 빠른 업데이트 |
| 온보딩 | 웹뷰 | 복잡한 폼, A/B 테스트 용이 |
| 프로필 | 웹뷰 | 자주 변경되는 기능 |
| 스캔 결과 | 웹뷰 | 복잡한 UI, 데이터 표시 |
| 설정 | 네이티브 | 권한 관리, 시스템 연동 |

**선택 기준:**
- 네이티브 기능 필요 여부 (카메라, 권한 등)
- 업데이트 빈도 (자주 변경 → 웹뷰)
- UI 복잡도 (복잡한 UI → 웹뷰)

### 4. Feature-based Architecture (기능별 모듈화)

**의도:**
```
독립적인 부품들의 조립 형태로 구현
→ 추후 수정이 쉽도록
```

**구현:**
- 웹 앱: `apps/web/src/features/` 폴더 구조로 기능별 모듈화
  - auth, scan, dashboard, profile 등
- 모바일 앱: `apps/mobile/app/` Expo Router 파일 기반 라우팅
- 각 feature는 독립적으로 작동
- Public API 패턴으로 깔끔한 인터페이스 제공

**장점:**
- ✅ **유지보수성**: 기능별로 코드가 분리되어 수정이 쉬움
- ✅ **확장성**: 새 기능 추가가 용이
- ✅ **협업**: 여러 개발자가 동시에 작업 가능
- ✅ **테스트**: 기능별로 독립적으로 테스트 가능

### 5. 타입 안전성 확보

**의도:**
```
TypeScript strict 모드로 런타임 에러 방지
→ 웹과 모바일 간 타입 일관성 유지
```

**구현:**
- 모든 컴포넌트에 타입 정의
- `any` 타입 사용 금지
- 인터페이스로 데이터 구조 명확화
- `packages/shared`로 공통 타입 공유

**장점:**
- ✅ **에러 예방**: 컴파일 타임에 오류 발견
- ✅ **자동 완성**: IDE에서 정확한 타입 힌트
- ✅ **문서화**: 타입 자체가 문서 역할
- ✅ **일관성**: 웹과 모바일 간 타입 동기화

### 6. 재사용 가능한 컴포넌트

**의도:**
```
shadcn/ui + Radix UI로 접근성 있는 UI 컴포넌트
→ 웹뷰에서 일관된 사용자 경험 제공
```

**구현:**
- 웹 앱: `apps/web/src/components/ui/` - 53개의 재사용 가능한 UI 컴포넌트
- 웹 앱: `apps/web/src/components/common/` - 공통 비즈니스 컴포넌트
- 모바일 앱: `apps/mobile/components/` - 네이티브 컴포넌트 (WebViewScreen 등)
- Tailwind CSS로 일관된 스타일링 (웹뷰)
- React Native StyleSheet (네이티브 화면)

**장점:**
- ✅ **일관성**: 전체 앱에서 동일한 디자인
- ✅ **접근성**: Radix UI로 a11y 자동 지원
- ✅ **개발 속도**: 기존 컴포넌트 재사용으로 빠른 개발
- ✅ **플랫폼 최적화**: 각 플랫폼에 맞는 최적의 컴포넌트 사용

---

## 🌍 사용자 경험 개선 의도

### 1. 다국어 지원 (5개 언어)

**의도:**
```
한국인 여행자가 전 세계 어디서나 사용할 수 있도록
```

**구현:**
- 한국어 (ko) - 기본 언어
- 영어 (en)
- 일본어 (ja)
- 중국어 (zh)
- 스페인어 (es)

**특징:**
- ✅ **자동 저장**: 언어 설정이 localStorage에 저장되어 유지
- ✅ **타입 안전성**: 모든 언어에 동일한 키 보장
- ✅ **동적 번역**: `useTranslation` 훅으로 간편하게 사용

### 2. Safety Card (PIN 보안)

**의도:**
```
레스토랑에서 안전하게 알레르기 정보를 공유
```

**구현:**
- 4자리 PIN으로 보호
- 한국어/영어 병기 표시
- 알레르기 심각도별 색상 코딩

**사용 시나리오:**
1. 사용자가 레스토랑에 도착
2. Safety Card 열기 (PIN 입력)
3. 직원에게 카드 보여주기
4. 직원이 알레르기 정보 확인 후 안전한 메뉴 추천

### 3. 실시간 메뉴 분석 (하이브리드 구현)

**의도:**
```
메뉴판을 촬영하면 즉시 알레르기 정보 확인
→ 네이티브 카메라 + 웹뷰 결과 표시
```

**구현:**
- **네이티브**: expo-camera로 카메라 접근 및 촬영
- **웹뷰**: Gemini 1.5 Flash OCR (텍스트 추출)
- **웹뷰**: 식품안전나라 API (레시피 정보)
- **웹뷰**: Gemini AI 알레르기 분석
- **웹뷰**: 위험도별 색상 코딩으로 결과 표시

**플로우:**
```
네이티브 카메라 촬영
  ↓
브릿지 프로토콜로 웹뷰에 이미지 전달
  ↓
웹뷰에서 OCR (텍스트 추출)
  ↓
레시피 검색 (선택)
  ↓
알레르기 분석
  ↓
웹뷰에서 결과 표시 (Safe/Caution/Warning/Danger)
```

**장점:**
- ✅ **네이티브 성능**: 카메라 접근이 빠르고 안정적
- ✅ **웹 기술 활용**: 복잡한 분석 로직은 웹에서 처리
- ✅ **빠른 업데이트**: 분석 로직 변경 시 웹뷰만 업데이트

---

## 📐 코드 품질 개선 의도

### 1. 명확한 모노레포 폴더 구조

**의도:**
```
새로운 개발자도 쉽게 이해할 수 있는 구조
→ 웹과 모바일의 역할이 명확히 구분
```

**구조:**
```
safemeals-monorepo/
├── apps/
│   ├── web/                    # Next.js 웹 앱 (웹뷰)
│   │   └── src/
│   │       ├── app/            # Next.js 라우팅
│   │       ├── features/       # 기능별 모듈 (핵심 로직)
│   │       ├── components/    # 공통 컴포넌트
│   │       ├── commons/        # 전역 레이아웃, 상수, 스토어
│   │       ├── lib/            # 유틸리티
│   │       └── hooks/          # 커스텀 훅
│   │
│   └── mobile/                 # React Native 네이티브 앱
│       ├── app/                # Expo Router 파일 기반 라우팅
│       ├── components/         # 네이티브 컴포넌트
│       └── ...
│
└── packages/
    └── shared/                 # 공유 패키지
        └── src/
            ├── bridge-protocol/# 웹뷰-네이티브 통신
            ├── types/          # 공통 타입
            └── constants/      # 공통 상수
```

### 2. 문서화

**의도:**
```
코드 자체가 문서 역할을 하도록
```

**구현:**
- JSDoc 주석 추가
- TypeScript 타입으로 인터페이스 명확화
- 프롬프트 파일로 기능별 가이드 작성

### 3. 일관된 코딩 스타일

**의도:**
```
팀 전체가 동일한 스타일로 개발
```

**규칙:**

웹 앱:
- Tailwind CSS만 사용 (CSS Module 금지)
- `'use client'` 명시
- 하드코딩 금지 (다국어 지원)
- 절대 경로 사용 (`@/`)
- `isNativeApp()` 체크 후 브릿지 사용

모바일 앱:
- React Native StyleSheet.create 사용
- Expo Router 파일 기반 라우팅
- 브릿지 프로토콜 타입 준수
- 웹뷰는 웹 앱의 스타일 규칙 따름

---

## 🎨 디자인 의도

### 1. 모바일 네이티브 우선 설계

**의도:**
```
외식 시 스마트폰으로 바로 사용
→ 네이티브 앱으로 최적화된 경험 제공
```

**구현:**
- **네이티브 앱**: React Native로 네이티브 성능과 UX
- **웹뷰**: 반응형 디자인 (모바일/태블릿/데스크톱)
- **터치 친화적 UI**: 큰 버튼과 명확한 시각적 피드백
- **햅틱 피드백**: 네이티브 기능으로 사용자 경험 향상

### 2. 색상 코딩

**의도:**
```
위험도를 한눈에 파악
```

**구현:**
- 🟢 **Safe** (초록) - 안전
- 🟡 **Caution** (노랑) - 주의
- 🟠 **Warning** (주황) - 경고
- 🔴 **Danger** (빨강) - 위험

### 3. 접근성 (a11y)

**의도:**
```
모든 사용자가 사용할 수 있도록
```

**구현:**
- Radix UI로 키보드 네비게이션 지원
- 스크린 리더 지원
- 색상 대비 확보

---

## 🔒 보안 의도

### 1. PIN 보안 시스템

**의도:**
```
민감한 건강 정보를 안전하게 보호
```

**구현:**
- 4자리 PIN 입력
- SHA-256 해싱 (프로덕션에서는 bcrypt 권장)
- 시도 횟수 제한 (5회)
- 30초 락아웃

### 2. 데이터 보호

**의도:**
```
사용자 정보를 안전하게 저장
```

**구현:**
- Supabase RLS (Row Level Security) 정책
- 사용자는 자신의 데이터만 접근 가능
- 환경 변수로 API 키 관리

---

## 📊 개발 원칙 요약

### 1. 독립적인 부품들의 조립
```
각 컴포넌트는 독립적으로 작동
→ 재사용 가능
→ 테스트 용이
→ 수정이 쉬움
```

### 2. 명시된 파일만 수정
```
의도치 않은 사이드 이펙트 방지
→ 안정성 확보
```

### 3. Step-by-step 구현
```
1. 피그마 분석
2. 네이티브 vs 웹뷰 결정 (화면별)
3. package.json 확인
4. 폴더 구조 분석
5. 브릿지 프로토콜 확인 (필요 시)
6. 구현
7. 전체 검토 및 빌드 확인
```

---

## 🎯 최종 목표

### 사용자 관점
- ✅ **안전한 식사**: 알레르기로부터 안전하게 식사
- ✅ **편리함**: 메뉴 스캔으로 즉시 정보 확인
- ✅ **글로벌**: 전 세계 어디서나 사용 가능

### 개발자 관점
- ✅ **유지보수성**: 수정이 쉬운 구조
- ✅ **확장성**: 새 기능 추가가 용이
- ✅ **품질**: 타입 안전성과 테스트 가능한 코드
- ✅ **하이브리드 아키텍처**: 각 플랫폼의 장점 활용
- ✅ **코드 공유**: 모노레포로 타입과 브릿지 프로토콜 공유

### 비즈니스 관점
- ✅ **시장 진입**: 한국인 여행자 타겟
- ✅ **확장 가능**: 다국어 지원으로 글로벌 확장 가능
- ✅ **차별화**: AI 기반 실시간 분석

---

## 📝 결론

**SafeMeals는 단순한 앱이 아닙니다.**

1. **사용자 문제 해결**: 알레르기로 고민하는 사람들을 위한 솔루션
2. **기술적 우수성**: 
   - 모노레포 하이브리드 아키텍처로 각 플랫폼의 장점 활용
   - 확장 가능하고 유지보수하기 쉬운 구조
   - 타입 안전한 브릿지 프로토콜로 웹-네이티브 통신
3. **사용자 경험**: 
   - 네이티브 앱의 성능과 웹 기술의 유연성 결합
   - 직관적이고 접근성 있는 인터페이스
4. **보안**: 민감한 건강 정보를 안전하게 보호

**"안전하게, 어디서나"** - 이 한 문장이 SafeMeals의 모든 의도를 담고 있습니다.

**하이브리드 아키텍처의 핵심:**
- 네이티브 성능 (카메라, 권한 관리)
- 웹 기술의 빠른 개발과 업데이트 (복잡한 UI)
- 타입 안전한 브릿지 프로토콜로 두 세계를 연결

---

**작성일**: 2025-12-23  
**작성자**: 한창기 +  AI assistant


