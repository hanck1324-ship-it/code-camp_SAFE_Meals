# SafeMeals 유저 플로우

## 📱 전체 플로우 개요

```
앱 시작
  ↓
스플래시 화면 (네이티브)
  ↓
온보딩 여부 확인
  ├─ 미완료 → 온보딩 (웹뷰)
  └─ 완료 → 메인 탭
```

---

## 🚀 1. 앱 시작 플로우

### 1-1. 스플래시 화면
- **구현 방식**: 네이티브
- **화면**: `apps/mobile/app/index.tsx`
- **동작**:
  1. 앱 로딩 중 스플래시 표시
  2. 온보딩 완료 여부 확인 (AsyncStorage)
  3. 초기화 완료 후 다음 화면으로 이동

---

## 🎯 2. 온보딩 플로우

### 2-1. 온보딩 화면
- **구현 방식**: 웹뷰
- **경로**: `/onboarding`
- **주요 단계**:
  1. 알레르기 정보 입력 (`/onboarding/allergy`)
  2. 알레르기 상세 설정 (`/onboarding/allergy-detail`)
  3. 식단 정보 입력 (`/onboarding/diet`)
  4. 식단 상세 설정 (`/onboarding/diet-detail`)
  5. 온보딩 완료 → 메인 탭으로 이동

---

## 🏠 3. 메인 탭 네비게이션

### 3-1. 탭 구조
- **구현 방식**: 네이티브 (Expo Router Tabs)
- **화면**: `apps/mobile/app/(tabs)/_layout.tsx`
- **탭 구성**:
  - 🏠 **홈** (`/`)
  - 📷 **스캔** (`/scan`)
  - 👤 **프로필** (`/profile`)
  - ⚙️ **설정** (`/settings`)

---

## 🏡 4. 홈 탭 플로우

### 4-1. 대시보드 화면
- **구현 방식**: 웹뷰
- **경로**: `/` (웹뷰)
- **기능**:
  - 식품 안전 정보 대시보드
  - 최근 스캔 내역
  - 알레르기/식단 정보 요약

---

## 📷 5. 스캔 탭 플로우

### 5-1. 바코드 스캔 화면
- **구현 방식**: 네이티브
- **화면**: `apps/mobile/app/(tabs)/scan.tsx`
- **동작**:
  1. 카메라 권한 확인
  2. 바코드 스캔 (EAN13, EAN8, UPC, QR 등)
  3. 스캔 성공 시 햅틱 피드백
  4. 스캔 결과 화면으로 이동

### 5-2. 스캔 결과 화면
- **구현 방식**: 웹뷰
- **경로**: `/scan/result?barcode={바코드}`
- **기능**:
  - 식품 정보 표시
  - 알레르기 성분 확인
  - 안전성 평가
  - 상세 정보 제공

---

## 👤 6. 프로필 탭 플로우

### 6-1. 프로필 메인 화면
- **구현 방식**: 웹뷰
- **경로**: `/profile`
- **기능**:
  - 사용자 정보 표시
  - 프로필 설정
  - 안전 카드 (`/profile/safety-card`)
  - 도움말 (`/profile/help`)
  - 언어 설정 (`/profile/language`)
  - 알림 설정 (`/profile/notifications`)

---

## ⚙️ 7. 설정 탭 플로우

### 7-1. 설정 화면
- **구현 방식**: 네이티브
- **화면**: `apps/mobile/app/(tabs)/settings.tsx`
- **기능**:
  - 앱 설정 관리
  - 권한 관리
  - 시스템 연동 설정

---

## 🔐 8. 인증 플로우 (추가)

### 8-1. 로그인/회원가입
- **구현 방식**: 웹뷰
- **경로**: 
  - 로그인: `/auth/login`
  - 회원가입: `/auth/signup`
- **동작**:
  1. 인증 화면 표시
  2. 로그인/회원가입 처리
  3. 인증 완료 후 메인 화면으로 이동

---

## 📊 플로우 다이어그램

```
[앱 시작]
    ↓
[스플래시] (네이티브)
    ↓
[온보딩 확인]
    ├─ 미완료 → [온보딩] (웹뷰)
    │              ├─ 알레르기 입력
    │              └─ 식단 입력
    │
    └─ 완료 → [메인 탭] (네이티브)
                ├─ [홈] → 대시보드 (웹뷰)
                ├─ [스캔] → 카메라 (네이티브) → 결과 (웹뷰)
                ├─ [프로필] → 프로필 (웹뷰)
                └─ [설정] → 설정 (네이티브)
```

---

## 🎨 화면별 구현 방식 요약

| 화면 | 구현 방식 | 이유 |
|------|----------|------|
| 스플래시 | 네이티브 | 앱 시작 속도, 브랜딩 |
| 온보딩 | 웹뷰 | 복잡한 폼, 빠른 업데이트 |
| 대시보드 | 웹뷰 | 복잡한 UI, 데이터 표시 |
| 바코드 스캔 | 네이티브 | 카메라 접근, 성능 |
| 스캔 결과 | 웹뷰 | 복잡한 UI, 데이터 표시 |
| 프로필 | 웹뷰 | 자주 변경되는 기능 |
| 설정 | 네이티브 | 권한 관리, 시스템 연동 |

---

## 🔄 주요 네비게이션 경로

### 네이티브 → 웹뷰
- 홈 탭 → `/` (대시보드)
- 프로필 탭 → `/profile`
- 스캔 완료 → `/scan/result?barcode={바코드}`

### 웹뷰 → 네이티브
- 브릿지 프로토콜을 통한 통신
- 카메라 스캔 요청
- 네이티브 화면 이동
- 결제/공유 등 네이티브 기능 호출

---

## 📝 참고사항

- 모든 웹뷰 화면은 `apps/mobile/app/webview/[...path].tsx`를 통해 라우팅
- 네이티브-웹뷰 통신은 `packages/shared/src/bridge-protocol` 사용
- URL 상수는 `apps/web/src/commons/constants/url.ts`에 정의

